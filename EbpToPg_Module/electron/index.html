<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EBP Sync Manager</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40">
                    <circle cx="20" cy="20" r="18" fill="#4CAF50"/>
                    <path d="M 15 20 L 18 23 L 25 16" stroke="white" stroke-width="3" fill="none"/>
                </svg>
                <h1>EBP Sync Manager</h1>
            </div>
            <div class="status-indicator">
                <div class="status-dot" id="statusDot"></div>
                <span id="statusText">D√©connect√©</span>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="tabs">
            <button class="tab active" data-tab="config">
                <span class="tab-icon">‚öôÔ∏è</span>
                Configuration
            </button>
            <button class="tab" data-tab="server">
                <span class="tab-icon">üñ•Ô∏è</span>
                Serveur
            </button>
            <button class="tab" data-tab="sync">
                <span class="tab-icon">üîÑ</span>
                Synchronisation
            </button>
            <button class="tab" data-tab="verify">
                <span class="tab-icon">‚úîÔ∏è</span>
                V√©rification
            </button>
            <button class="tab" data-tab="backup">
                <span class="tab-icon">üíæ</span>
                Backup
            </button>
            <button class="tab" data-tab="logs">
                <span class="tab-icon">üìú</span>
                Logs
            </button>
        </nav>

        <!-- Content Panels -->
        <main class="content">
            <!-- Configuration Panel -->
            <div class="panel active" id="config-panel">
                <h2>‚öôÔ∏è Configuration des Connexions</h2>

                <div class="card">
                    <h3>Connexion EBP (Source)</h3>
                    <div class="form-group">
                        <label>Serveur EBP</label>
                        <input type="text" id="ebpServer" placeholder="SRVEBP-2022\\SRVEBP">
                        <small>Format: NOM_SERVEUR\\INSTANCE</small>
                    </div>
                    <div class="form-group">
                        <label>Base de donn√©es</label>
                        <input type="text" id="ebpDatabase" placeholder="Solution Logique_xxx">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Utilisateur</label>
                            <input type="text" id="ebpUser" value="sa">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" id="ebpPassword">
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="testEBPConnection()">
                        üîå Tester la connexion EBP
                    </button>
                </div>

                <div class="card">
                    <h3>Connexion PostgreSQL (Destination)</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>H√¥te</label>
                            <input type="text" id="pgHost" value="localhost">
                        </div>
                        <div class="form-group">
                            <label>Port</label>
                            <input type="number" id="pgPort" value="5432">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Base de donn√©es</label>
                        <input type="text" id="pgDatabase" value="ebp_db">
                        <small>Sera cr√©√©e automatiquement si inexistante</small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Utilisateur</label>
                            <input type="text" id="pgUser" value="postgres">
                        </div>
                        <div class="form-group">
                            <label>Mot de passe</label>
                            <input type="password" id="pgPassword">
                        </div>
                    </div>
                    <button class="btn btn-secondary" onclick="testPGConnection()">
                        üîå Tester la connexion PostgreSQL
                    </button>
                </div>

                <div class="actions">
                    <button class="btn btn-primary" onclick="saveConfig()">
                        üíæ Sauvegarder la configuration
                    </button>
                    <button class="btn btn-secondary" onclick="loadConfigFromEnv()">
                        üîÑ Recharger depuis .env
                    </button>
                </div>
            </div>

            <!-- Server Control Panel -->
            <div class="panel" id="server-panel">
                <h2>üñ•Ô∏è Contr√¥le du Serveur Backend</h2>

                <div class="card">
                    <h3>√âtat du Serveur</h3>
                    <div id="serverStatus">
                        <p><strong>Statut:</strong> <span id="serverStatusText">V√©rification...</span></p>
                        <p><strong>PID:</strong> <span id="serverPID">-</span></p>
                        <p><strong>Port:</strong> <span id="serverPort">3000</span></p>
                    </div>

                    <div class="actions" style="margin-top: 1.5rem;">
                        <button class="btn btn-primary" onclick="startServerManually()">
                            ‚ñ∂Ô∏è D√©marrer
                        </button>
                        <button class="btn btn-danger" onclick="stopServerManually()">
                            ‚èπÔ∏è Arr√™ter
                        </button>
                        <button class="btn btn-warning" onclick="restartServer()">
                            üîÑ Red√©marrer
                        </button>
                    </div>
                </div>

                <div class="card">
                    <h3>Logs du Serveur</h3>
                    <div class="logs-container" id="serverLogsContainer">
                        <div class="log-entry">En attente de logs du serveur...</div>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="clearServerLogs()" style="margin-top: 1rem;">
                        üóëÔ∏è Effacer les logs
                    </button>
                </div>

                <div class="card">
                    <h3>Informations de Connexion</h3>
                    <div id="connectionInfo">
                        <p><strong>URL API:</strong> <span>http://localhost:3000/api</span></p>
                        <p><strong>EBP Serveur:</strong> <span id="infoEBPServer">-</span></p>
                        <p><strong>EBP Database:</strong> <span id="infoEBPDatabase">-</span></p>
                        <p><strong>PostgreSQL:</strong> <span id="infoPGDatabase">-</span></p>
                    </div>
                    <button class="btn btn-secondary" onclick="refreshConnectionInfo()">
                        üîÑ Actualiser
                    </button>
                </div>
            </div>

            <!-- Synchronisation Panel -->
            <div class="panel" id="sync-panel">
                <h2>üîÑ Synchronisation</h2>

                <div class="card">
                    <h3>Synchronisation Compl√®te</h3>
                    <p>Synchronise toutes les donn√©es d'EBP vers PostgreSQL</p>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dropAndCreate">
                            Mode destructif (Supprime et recr√©e les tables)
                        </label>
                        <small>Si d√©coch√©, vide simplement les tables existantes</small>
                    </div>

                    <div class="form-group">
                        <label>Tables √† synchroniser (optionnel)</label>
                        <input type="text" id="syncTables" placeholder="Laisser vide pour tout synchroniser">
                        <small>S√©par√©es par des virgules, ex: customers,items</small>
                    </div>

                    <button class="btn btn-primary btn-large" onclick="startFullSync()">
                        üöÄ Lancer la Synchronisation Compl√®te
                    </button>
                </div>

                <div class="card" id="syncProgress" style="display: none;">
                    <h3>Progression</h3>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div id="syncStatus"></div>
                </div>

                <div class="card" id="syncResults" style="display: none;">
                    <h3>R√©sultats</h3>
                    <div id="syncResultsContent"></div>
                </div>
            </div>

            <!-- V√©rification Panel -->
            <div class="panel" id="verify-panel">
                <h2>‚úîÔ∏è V√©rification</h2>

                <div class="card">
                    <h3>V√©rifier la Synchronisation</h3>
                    <p>Compare les donn√©es entre EBP et PostgreSQL pour d√©tecter les diff√©rences</p>

                    <div class="form-group">
                        <label>Tables √† v√©rifier (optionnel)</label>
                        <input type="text" id="verifyTables" placeholder="Laisser vide pour tout v√©rifier">
                        <small>Ex: customers,items</small>
                    </div>

                    <div class="form-group">
                        <label>Nombre d'√©chantillons par table</label>
                        <input type="number" id="sampleSize" value="100" min="0">
                        <small>0 = v√©rifier toutes les lignes (plus lent)</small>
                    </div>

                    <button class="btn btn-primary btn-large" onclick="startVerification()">
                        üîç Lancer la V√©rification
                    </button>
                </div>

                <div class="card" id="verifyResults" style="display: none;">
                    <h3>R√©sultats de V√©rification</h3>
                    <div id="verifyResultsContent"></div>
                    <button class="btn btn-warning" id="repairBtn" onclick="repairSync()" style="display: none;">
                        üîß R√©parer les Probl√®mes D√©tect√©s
                    </button>
                </div>
            </div>

            <!-- Backup Panel -->
            <div class="panel" id="backup-panel">
                <h2>üíæ Backup</h2>

                <div class="card">
                    <h3>Cr√©er un Backup PostgreSQL</h3>
                    <p>Sauvegarde la base de donn√©es PostgreSQL dans le dossier /backup</p>

                    <div class="form-group">
                        <label>Format</label>
                        <select id="backupFormat">
                            <option value="plain">SQL (texte)</option>
                            <option value="custom">Custom (compress√©)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Syst√®me d'exploitation</label>
                        <select id="backupOS">
                            <option value="">Auto (d√©tection automatique)</option>
                            <option value="windows">ü™ü Windows</option>
                            <option value="linux">üêß Linux / macOS</option>
                        </select>
                        <small>Choisir Windows si la d√©tection automatique √©choue</small>
                    </div>

                    <div class="form-group">
                        <label>Tables √† sauvegarder (optionnel)</label>
                        <input type="text" id="backupTables" placeholder="Laisser vide pour tout sauvegarder">
                    </div>

                    <button class="btn btn-primary btn-large" onclick="createBackup()">
                        üíæ Cr√©er un Backup
                    </button>
                </div>

                <div class="card">
                    <h3>Backups Existants</h3>
                    <button class="btn btn-secondary" onclick="loadBackupsList()">
                        üîÑ Actualiser
                    </button>
                    <div id="backupsList"></div>
                </div>
            </div>

            <!-- Logs Panel -->
            <div class="panel" id="logs-panel">
                <h2>üìú Logs</h2>

                <div class="card">
                    <div class="logs-header">
                        <h3>Logs en temps r√©el</h3>
                        <button class="btn btn-secondary btn-small" onclick="clearLogs()">
                            üóëÔ∏è Effacer
                        </button>
                    </div>
                    <div class="logs-container" id="logsContainer">
                        <div class="log-entry">En attente de logs...</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Notifications Toast -->
        <div id="toast" class="toast"></div>
    </div>

    <script src="renderer.js"></script>
</body>
</html>
